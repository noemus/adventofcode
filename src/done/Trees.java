package done;

import java.nio.charset.StandardCharsets;
import java.util.Objects;
import java.util.Scanner;
import java.util.function.Supplier;
import java.util.stream.Stream;

import static java.lang.String.format;

public class Trees {

    static byte[][] rectangle;
    static int rows;
    static int cols;

    static Slope[] slopes = {
            new Slope(1, 1),
            new Slope(3, 1),
            new Slope(5, 1),
            new Slope(7, 1),
            new Slope(1, 2),
    };

    public static void main(String[] args) {
        try (Scanner in = new Scanner(INPUT)) {
            rectangle = Stream.generate(new LineSupplier(in))
                    .takeWhile(Objects::nonNull)
                    .map(Trees::toMapLine)
                    .toArray(byte[][]::new);

            rows = rectangle.length;
            cols = rectangle[0].length;

            do {
                for (Slope slope : slopes) {
                    slope.advance();
                    //System.out.println("Slope: " + slope);
                }
                //System.out.println("=============");
            } while (canContinue());

            int product = Stream.of(slopes)
                    .mapToInt(Slope::count)
                    .reduce(1, (n1, n2) -> n1 * n2);

            System.out.println("Result: " + product);
        }
    }

    private static byte[] toMapLine(String line) {
        return line.getBytes(StandardCharsets.UTF_8);
    }

    static boolean canContinue() {
        for (Slope slope : slopes) {
            if (slope.canContinue()) {
                return true;
            }
        }
        return false;
    }

    static class Slope {
        final int deltaX;
        final int deltaY;
        int x = 0;
        int y = 0;
        int count = 0;

        Slope(int deltaX, int deltaY) {
            this.deltaX = deltaX;
            this.deltaY = deltaY;
        }

        void advance() {
            if (!canContinue()) {
                return;
            }

            if (rectangle[y][x] == '#') {
                count++;
            }

            x += deltaX;
            x %= cols;
            y += deltaY;
        }

        boolean canContinue() {
            return y < rows;
        }

        int count() {
            return count;
        }

        @Override
        public String toString() {
            return format("[%s,%s]: %d", deltaX, deltaY, count);
        }
    }

    private static final String INPUT2 = "" +
            "..##.......\n" +
            "#...#...#..\n" +
            ".#....#..#.\n" +
            "..#.#...#.#\n" +
            ".#...##..#.\n" +
            "..#.##.....\n" +
            ".#.#.#....#\n" +
            ".#........#\n" +
            "#.##...#...\n" +
            "#...##....#\n" +
            ".#..#...#.#\n";

    private static final String INPUT = "" +
            "...#..............#.#....#..#..\n" +
            "...#..#..#..............#..#...\n" +
            "....#.#.......#............#...\n" +
            "..##.....##.........#........##\n" +
            "...#...........#...##.#...#.##.\n" +
            "..#.#...#....#.....#........#..\n" +
            "....##.###.....#..#.......#....\n" +
            ".#..##...#.....#......#..#.....\n" +
            "............##.#...#.#.....#.#.\n" +
            "..........#....#....#.#...#...#\n" +
            "..##....#.#.#......#.........#.\n" +
            "#.#.........#..............##..\n" +
            "....##.##......................\n" +
            "....##..#...........#..........\n" +
            "..#..#.#........##....#......#.\n" +
            "..............#..#....#.....#..\n" +
            ".............#...#.....#...#...\n" +
            ".#...........#..........#...#..\n" +
            ".#......#.......#......#.......\n" +
            "#..#.............#..#....##.###\n" +
            "........#.#...........##.#...#.\n" +
            "......#..#.....##......#.......\n" +
            ".....#.....#....#..............\n" +
            "#...##.#......#......#...#.....\n" +
            "...........................#...\n" +
            "...#....................#.....#\n" +
            "..#.....#...#.....##.....#.....\n" +
            "....................#......#..#\n" +
            ".......#.....##......##....#...\n" +
            "#........##...#.....##..#...#..\n" +
            "........#..#.#......#..###..#.#\n" +
            "##.....#.............#.#....#..\n" +
            "..#.................#....######\n" +
            ".#.#..#.....#.#..........#.#...\n" +
            ".........#....#...#............\n" +
            "........#..#.....#.............\n" +
            "............#.#.............##.\n" +
            "...#....#..#......#............\n" +
            ".##....#.....#...#.#...........\n" +
            "..#..............#...........##\n" +
            ".....#.#.##...#................\n" +
            "..........#..#.#..........##..#\n" +
            "..#....#...#...#.....######....\n" +
            "....#.#..#........#....#.###...\n" +
            ".......................#.......\n" +
            "..#.....#.##................#..\n" +
            ".....#......#..#.....#........#\n" +
            ".#...###.......#.#.........#..#\n" +
            "............#..................\n" +
            "..#.........##.........##......\n" +
            "#...........#.#.......###.#....\n" +
            ".#...#.....#.........###.....#.\n" +
            ".#............#........#..#....\n" +
            "...##.#......##................\n" +
            "........#...#...#...#..........\n" +
            ".......#.##......##.#..........\n" +
            "....##.......#..#....#....#....\n" +
            "......#.........###........#...\n" +
            "#....#....####....##......#....\n" +
            "......................#....#.#.\n" +
            "...#.#.#....#.#...#...#......#.\n" +
            "......#.....##.#...........###.\n" +
            "#........#.........##......#.#.\n" +
            "....##.....#.....#..#..........\n" +
            "......#...#...#.........#...##.\n" +
            "..#........#..................#\n" +
            ".........#..##.#..#..#...#.#..#\n" +
            ".....#.....#...#.....###.....##\n" +
            ".............#....#...#........\n" +
            "..........#.#.#...#..#...#....#\n" +
            "#...............##.......#.....\n" +
            "#...#.............#..#...#....#\n" +
            "..#...#...##...##...#..#.......\n" +
            "..#..#........#.#...........#..\n" +
            ".....#.....#..................#\n" +
            "....#....##....###..###...##...\n" +
            "..#......###.........##....#.##\n" +
            ".......#.##...#.......#..#.....\n" +
            "...#.#.#.#.....##..#..#........\n" +
            "................##....#.#......\n" +
            "..#...#...#...#.....##.#...#..#\n" +
            "..#..#.....#..##....#....#.....\n" +
            ".###...#......#........#.....##\n" +
            "##......#..#........#..........\n" +
            "....#...#..#....##..#......####\n" +
            ".#.....##....#..........#......\n" +
            ".#...#....#.........#...#....#.\n" +
            ".....#..#.#..#......#..##....#.\n" +
            "...#.##...#...#........#......#\n" +
            ".#..#...#.#..#.........#...#...\n" +
            "#....#......##.....#.......#...\n" +
            "..##............##..#.#.#...#..\n" +
            "##.......#.......##............\n" +
            "#......#.##........#...#...#...\n" +
            ".#.#.......##.........#..#.#...\n" +
            ".............##.#........#.....\n" +
            ".#..#...###...#..#.............\n" +
            ".....#...#..#....#.......#.....\n" +
            "#.#.........#.#.#...#...#.#....\n" +
            ".....#.......#.##.##...#....#..\n" +
            ".#.##..#.....#...#.#.#.#.#..#..\n" +
            "..........#...................#\n" +
            ".....#.#.#...##.........#..#..#\n" +
            ".#..#....##......#...#.........\n" +
            ".##......#......#...#........#.\n" +
            ".....##.#......#............#.#\n" +
            ".#.....##..#...........##......\n" +
            ".....#......#.......##....#....\n" +
            "..#..##..........#.#..........#\n" +
            "#.#.......##..#..##.#....#.....\n" +
            ".......#..#.#.......##......#.#\n" +
            "....#...##...#..............#..\n" +
            ".....#.........#......#...##...\n" +
            "#.........#........##..#.....#.\n" +
            ".#.#..#.....##.......#......#..\n" +
            "........#..#....#.....###..#...\n" +
            "#.#..#.#..........#............\n" +
            "..#......##..#....#.........#..\n" +
            "#..............................\n" +
            ".......#............#..#..#.#..\n" +
            ".#.....#.#....#..#.##.#........\n" +
            ".......#.###.#........##.#..#..\n" +
            "..............#....#.....##.#..\n" +
            "#..............#....#.###......\n" +
            ".#..#..#...###............#...#\n" +
            ".#.##...#....#..#...#...#......\n" +
            "......##..#..#......#..#....#..\n" +
            ".........#.......##............\n" +
            "...........##...#..#....####...\n" +
            ".#..................#..........\n" +
            "#...#..#..................#....\n" +
            "..............#.....##.....#...\n" +
            "..#.#..#...##..#.....#.....#..#\n" +
            "....#....#.#.........#.....#...\n" +
            ".#.......#...#....#...#.#..#..#\n" +
            "#.........##.....##.......#...#\n" +
            "#..#............#....#........#\n" +
            "..........##...#......#....#...\n" +
            ".......#..##...............#...\n" +
            "#............#.#.#.....#.......\n" +
            ".#........##...#...............\n" +
            "..##....#.....#..#.##.#......#.\n" +
            ".#...#.............#...#.....#.\n" +
            "...##....#.......#......#.#..#.\n" +
            "#......................#..#.##.\n" +
            "...#..........#..#.........#...\n" +
            "..#......#.......#.#....#......\n" +
            "....#............#...#......#..\n" +
            ".....#..#..##...#...#.........#\n" +
            ".....#......#....#....#........\n" +
            ".............#..#..........#...\n" +
            "....#..............#.....#.#...\n" +
            "....#.................#.#...#.#\n" +
            ".........#.#...........###.#.##\n" +
            "#...........#..##.#....#.##.#..\n" +
            "#.#.....#......................\n" +
            "##.#.........#....##.#.#..#.#..\n" +
            "#..........#.#.#.#.#..#..##..#.\n" +
            "..#...#..###.........#......#..\n" +
            ".....#......#..#.#............#\n" +
            "...........#...#.#.#.###....#..\n" +
            "#....#..#.......##.#.......##..\n" +
            "..............#.....##.#.......\n" +
            ".#.....#.#..#.........#.#.#..#.\n" +
            "..#..#..#..#................#..\n" +
            "...........#..#.#...#.........#\n" +
            ".#..#..#...#........#...#.#..#.\n" +
            "...#.#..#......#..#............\n" +
            "........#......##.....#....#...\n" +
            "#...#......##.#.#..............\n" +
            ".#........................#....\n" +
            "#.#.....#.##.....#..#.#........\n" +
            "#..........##.#.......#....#..#\n" +
            "#...#..#..#.....#....#....#....\n" +
            "#...........#..#.#....##.##....\n" +
            "##......#..#........#.......##.\n" +
            "#........#..#...#..........#...\n" +
            "...#...#......##....#.#........\n" +
            "...##..#..#.##....#...#........\n" +
            "#.#..#....#...#........#.......\n" +
            "..........#.......#..........#.\n" +
            "......##...#....###...#....#...\n" +
            "........#..#.....#......#......\n" +
            "....#.........##...#..##......#\n" +
            "....#...........#.#..#.#.#.#..#\n" +
            "..#......#..#......#........#.#\n" +
            "#..#....#.....#.............#..\n" +
            "............................#..\n" +
            "#...#.#.....#...#....#....#....\n" +
            "........#...#...#...#...#......\n" +
            ".###........#....#.##.....##.#.\n" +
            ".........#.....#..........#....\n" +
            ".#.........#....##.#.....#.....\n" +
            "#..#....................##.#...\n" +
            "..##.#.............#....#.#....\n" +
            "..#.#........#............##.#.\n" +
            "#........#...##.....#...#.....#\n" +
            ".........#.#..........#....#..#\n" +
            "...###.#..#.#......#.#.....#...\n" +
            "......#.....#..#...#........#..\n" +
            ".......#...#.....#....#....#..#\n" +
            ".#.#........#......##.......#..\n" +
            "#.................###..........\n" +
            "#........#.#..#....#..#........\n" +
            "..##....#.#...##...#...##....#.\n" +
            "...#.#......##...#.....#..#....\n" +
            "#..#........#...###....#.......\n" +
            "##.#....#..#.#..........#......\n" +
            "....#...###...#.....#........#.\n" +
            "..#.#........#....##.#.........\n" +
            "......##.##.................##.\n" +
            ".#....##...#.#..#.#............\n" +
            ".#...###........#......#.......\n" +
            "##..#.#......#..#..#...#.......\n" +
            ".......##..#....#........#....#\n" +
            "......#..........#.............\n" +
            "....##..##..#......#.#.........\n" +
            ".....#....................##...\n" +
            "...###.....#.....#...#.#.##.#..\n" +
            "....#.#..#.......#..#......##..\n" +
            ".......#.#..#.##.#...#......#..\n" +
            "...#.#....#.#...#..##...#...#..\n" +
            "#.##...#....#..#.............#.\n" +
            "...#...#...#.......#..........#\n" +
            ".#..#.............#..##.#......\n" +
            "....#.......#..............#.#.\n" +
            "..................#..#.....##.#\n" +
            ".#...#..#......#..........#...#\n" +
            "..#.#.....#..#....#....#####.#.\n" +
            ".......###.......#....#....#...\n" +
            "......#.#........#...#.........\n" +
            "......#..#.#.#....#.#.#....##..\n" +
            ".#...#.#...##.#......#.........\n" +
            "#....#..##....#.#.......#....#.\n" +
            "..##.#.....#.....#.........#...\n" +
            "......#......#....#....#.....#.\n" +
            "...##.....#....#......#......#.\n" +
            "......#......##............#.#.\n" +
            ".##.#.......#....#...#....#....\n" +
            "....#..#..#...##.......#..#....\n" +
            "....#....#...#.#........#..#...\n" +
            "....#.....#..........#..#......\n" +
            "....#....#...#.....#..##.....#.\n" +
            "##...#..##......#....##..#..#..\n" +
            ".....##.##..............##.....\n" +
            "#.#....#.##..#....#...##.......\n" +
            "..#.....##.....#.....######...#\n" +
            "...#.....#.#.#......#......##.#\n" +
            "...........##.............#....\n" +
            "...##......#..#......#...#.....\n" +
            "....#.##......#..#....#.#..#...\n" +
            ".#..#....#...#..#.....##.......\n" +
            ".....#..#.................#..#.\n" +
            "................#..#...#......#\n" +
            "...##....#.....#..#....##......\n" +
            "....##...............##...#....\n" +
            "......#..........#..##.........\n" +
            ".......###.......#.........#..#\n" +
            "......................#....#.#.\n" +
            "#.#.....#...##............#....\n" +
            "........#......##......#.....#.\n" +
            "...#....#....#.#..##.#..#.#.#..\n" +
            "..#.#....#.##...#..#.....#.#...\n" +
            "............#....#..#.......#..\n" +
            "#...#...#.#......#...##.....#.#\n" +
            "......#....#....#.......#......\n" +
            "....#.......#..........#....#..\n" +
            "........#####........#....#....\n" +
            "......#....##..............#.#.\n" +
            "....#....#.......#.......#.....\n" +
            ".##.#....##....#...............\n" +
            "#.....##........#..#.#...#.#...\n" +
            "...#......##....#..............\n" +
            ".#.....#.....#.......##....##..\n" +
            "#....#..........#.#..#.........\n" +
            "......##..........##.......#...\n" +
            ".##......##.....#.#....#......#\n" +
            "....#......................#...\n" +
            ".#...........###........#...#..\n" +
            "#.#..#..#..#...##.#....#.#..#..\n" +
            "...##...........#.#..........#.\n" +
            "......#.#..#....#....#.........\n" +
            "....#....#.#......#.........##.\n" +
            ".#..#...#...##....#...#......#.\n" +
            "#.#......#...#.#.#...........#.\n" +
            "##.....#..........##....##..##.\n" +
            "...#.#.....#..##........#......\n" +
            "..#........##........#..#......\n" +
            ".......#...............##..#...\n" +
            ".......#.#....#..###...........\n" +
            ".............#........#...#....\n" +
            "#.................#......#..#..\n" +
            "...#....#..#..............#...#\n" +
            ".............#....##....#..##..\n" +
            "#........#..........##...##...#\n" +
            "............#....#.....#.#....#\n" +
            ".....#..............##..#...#..\n" +
            "..#....#......###....#.#...##..\n" +
            "....##......#.....#....#.......\n" +
            ".....#...............#.....#...\n" +
            ".#.....#.....#..............#..\n" +
            "#................#..#..........\n" +
            ".##....#....#.....#............\n" +
            "#.####...#..#..#....#..........\n" +
            "..##........##.....##......#..#\n" +
            "......#.....#...##.........##..\n" +
            "....##..#.....#.#.........#...#\n" +
            ".....##..#....#....#.#...#..#..\n" +
            "...#............#...........#..\n" +
            ".......#.#..#.#.#..#........#.#\n" +
            "....#.#........#.#.#..#...#...#\n" +
            "..#....#....#..#......#........\n" +
            ".#...........................#.\n" +
            ".#..#....####........##......#.\n" +
            ".#.....#..#.#.................#\n" +
            ".#..#...........#...#....#...#.\n" +
            "......##..#........#..#....#...\n" +
            "..#.............#....#........#\n" +
            "#.#..........#.##.......#.#..#.\n" +
            "..#....#...#...............#...\n" +
            "..............#..........#..#..\n" +
            "..#.....#.#.....#...#...#..#...\n" +
            ".........#...###.#...#........#\n";

    private static class LineSupplier implements Supplier<String> {
        final Scanner in;

        public LineSupplier(Scanner in) {
            this.in = in;
        }

        @Override
        public String get() {
            return in.hasNext()
                    ? in.nextLine()
                    : null;
        }
    }
}
